!function(e){var t=0,i=/[\-\[\]{}()*+?.,\\\^$|#\s]/g;e.widget("unikat.multiselect",{options:{header:!0,maxHeight:192,width:"100%",classes:"",checkAllText:"Check all",uncheckAllText:"Uncheck all",noneSelectedText:"Select options",noneSelectedSingleText:"Select option",selectedText:"# selected",selectedList:3,speed:null,autoOpen:!1,multiple:!0,showSubText:!1,searchDelay:100,filter:!0,filterMinOptions:10,filterLabel:"",filterPlaceholder:"Enter keywords",autoReset:!0,position:{}},_create:function(){var i=this.element.hide(),s=this.options;this.speed=s.speed||e.fx.speeds._default,this._isOpen=!1,this._namespaceID=this.eventNamespace||"multiselect"+t,this.wrapper=e("<div />").addClass("multiselectWrapper"),i.wrap(this.wrapper),this.button=e('<button type="button"><span class="caret"></span></button>').addClass("btn btn-block btn-default").addClass(s.classes).attr({title:i.attr("title"),"aria-haspopup":!0,tabIndex:i.attr("tabIndex")}).insertAfter(i),this.buttonlabel=e("<div />").html(s.multiple?s.noneSelectedText:s.noneSelectedSingleText).appendTo(this.button),this.menu=e("<section />").addClass("dropdown-menu").addClass(s.classes).insertAfter(this.button),s.multiple||this.menu.addClass("multiselect-single"),this.header=e("<header />").appendTo(this.menu),this.filterWrapper=e('<div class="multiselect-filter">'+s.filterLabel+"</div>").appendTo(this.header),this.filter=e('<input class="form-control" placeholder="'+s.filterPlaceholder+'" type="search" />').appendTo(this.filterWrapper),this.headerLinkContainer=e("<ul />").html(function(){return s.header===!0?'<li><a class="multiselect-all" href="#"><span class="glyphicon glyphicon-ok"></span>'+s.checkAllText+'</a></li><li><a class="multiselect-none" href="#"><span class="glyphicon glyphicon-remove"></span>'+s.uncheckAllText+"</a></li>":"string"==typeof s.header?"<li>"+s.header+"</li>":""}).append('<li class="multiselect-close"><a href="#" class="multiselect-close"><span class="glyphicon glyphicon-remove-circle"></span></a></li>').appendTo(this.header),this.checkboxContainer=e('<ul tabindex="-1" />').appendTo(this.menu),this._bindEvents(),this.refresh(!0),this.updateCache(),t++},_init:function(){this.options.header===!1&&this.header.hide(),this.options.filter===!1&&this.filterWrapper.hide(),this.options.multiple||this.headerLinkContainer.find(".multiselect-all, .multiselect-none").hide(),this.options.autoOpen&&this.open(),this.element.is(":disabled")&&this.disable()},refresh:function(i){var s=this.options,n=[],a="",o=this.element.attr("id")||t++,l=this;this.element.find("option").each(function(t){var i,r="multiselect-"+(this.id||o+"-option-"+t),c=[],d=this.className+" "+(s.multiple?"checkbox":"radio"),u=e(this).data("subText");"OPTGROUP"===this.parentNode.tagName&&(i=this.parentNode.getAttribute("label"),-1===e.inArray(i,n)&&(a+='<li class="multiselect-optgroup '+this.parentNode.className+(this.parentNode.disabled?" disabled multiselect-state-disabled":"")+'"><a href="#">'+i+"</a></li>",n.push(i),this.parentNode.disabled&&e(this.parentNode).children().each(l._toggleState("disabled",!0)))),this.disabled&&(c.push("multiselect-state-disabled"),d+=" disabled"),this.selected&&!s.multiple&&c.push("selected"),a+='<li class="'+d+'">',a+='<label for="'+r+'" title="'+this.title+'" class="'+c.join(" ")+'">',a+='<input id="'+r+'" name="multiselect_'+o+'" type="'+(s.multiple?"checkbox":"radio")+'" value="'+this.value+'" title="'+this.title+'"',this.selected&&(a+=" checked",a+=' aria-selected="true"'),this.disabled&&(a+=" disabled",a+=' aria-disabled="true"'),a+=" />"+this.innerHTML+(u?'<span class="sub-text">/ '+u+"</span>":"")+"</label></li>"}),this.checkboxContainer.html(a),this.optgroups=this.checkboxContainer.find("li.multiselect-optgroup"),this.labels=this.checkboxContainer.find("label"),this.inputs=this.labels.children("input"),s.filterMinOptions&&this.inputs.length>=s.filterMinOptions?this._setOption("filter",!0):this._setOption("filter",!1),this._setButtonWidth(),this.button[0].defaultValue=this.update(),i||this._trigger("refresh")},update:function(){var t,i=this,s=i.inputs.filter(":checked"),n=s.length;return t=0===n?i.options.multiple?i.options.noneSelectedText:i.options.noneSelectedSingleText:e.isFunction(i.options.selectedText)?i.options.selectedText.call(i,n,i.inputs.length,s.get()):/\d/.test(i.options.selectedList)&&i.options.selectedList>0&&n<=i.options.selectedList?s.map(function(){var t=e(this).next(),s=t.length?t[0].outerHTML:null;return e(this)[0].nextSibling.nodeValue+(i.options.showSubText&&s?s:"")}).get().join(", "):i.options.selectedText.replace("#",n).replace("#",i.inputs.length),i._setButtonValue(t),t},_setButtonValue:function(e){this.button.find("div").html(e)},_bindEvents:function(){var t=this;t.button.on("click",function(){return t[t._isOpen?"close":"open"](),!1}).on("keydown",function(e){switch(e.which){case 27:case 38:case 37:t.close();break;case 39:case 40:t.open()}}),t.menu.on("keydown",function(e){switch(e.which){case 27:e.preventDefault(),t.close()}}),t.filter.on("keydown",function(e){switch(e.which){case 13:e.preventDefault()}}).on("focus",function(){t.labels.removeClass("selected"),t.optgroups.removeClass("selected")}).on("keyup search input paste cut",e.debounce(t.options.searchDelay,function(){t._handler()})),e(document).on("multiselectrefresh",function(){t.updateCache(),t._handler()}).on("multiselectclose",function(){t._reset()}).on("mousedown."+t._namespaceID,function(i){var s=i.target;!t._isOpen||s===t.button[0]||s===t.menu[0]||e.contains(t.menu[0],s)||e.contains(t.button[0],s)||t.close()}),t.header.on("click","a",function(i){e(this).hasClass("multiselect-close")?t.close():t[e(this).hasClass("multiselect-all")?"checkAll":"uncheckAll"](),i.preventDefault()}).on("focus","a",function(){t.labels.removeClass("selected"),t.optgroups.removeClass("selected")}),t.checkboxContainer.on("click",".multiselect-optgroup a",function(i){i.preventDefault();var s=e(this).parent().nextUntil("li.multiselect-optgroup").find("input:visible:not(:disabled)");if(s.length){var n=s.get(),a=e(this).parent().text();if(t._trigger("beforeoptgrouptoggle",i,{inputs:n,label:a})===!1)return;t._toggleChecked(s.filter(":checked").length!==s.length,s),t._trigger("optgrouptoggle",i,{inputs:n,label:a,checked:n[0].checked})}}).on("mouseenter","label",function(){e(this).hasClass("multiselect-state-disabled")||e(this).addClass("selected").find("input").focus()}).on("mouseleave","label",function(){e(this).hasClass("multiselect-state-disabled")||t.labels.removeClass("selected")}).on("mouseenter",".multiselect-optgroup",function(){e(this).hasClass("multiselect-state-disabled")||e(this).addClass("selected").find("a").focus()}).on("mouseleave",".multiselect-optgroup",function(){e(this).hasClass("multiselect-state-disabled")||t.optgroups.removeClass("selected")}).on("keydown","label, .multiselect-optgroup a",function(i){switch(9!=i.which&&i.preventDefault(),i.which){case 9:e(this).parent()[i.shiftKey?"prevAll":"nextAll"]("li:not(:hidden, .disabled)").first().length&&(i.preventDefault(),i.shiftKey?t._traverse(38,this):t._traverse(40,this));break;case 38:case 40:case 37:case 39:t._traverse(i.which,this);break;case 13:var s=e(this).find("input");s.length?s[0].click():this.click()}}).on("click",'input[type="checkbox"], input[type="radio"]',function(i){var s=this.value,n=this.checked;return this.disabled||t._trigger("click",i,{value:s,text:this.title,checked:n})===!1?void i.preventDefault():(t._toggleChecked(n,e(this)),void(t.options.multiple||(t.labels.removeClass("multiselect-state-selected"),e(this).closest("label").toggleClass("multiselect-state-selected",n),t.close())))}).on("focus","input, .multiselect-optgroup a",function(){var i=e(this).parent();i.hasClass("selected")||(t.checkboxContainer.scrollTop(0),i.trigger("mouseenter"))})},_handler:function(t){var s=e.trim(this.filter[0].value.toLowerCase()),n=this.rows,a=this.inputs;if(s){n.hide();var o=new RegExp(s.replace(i,"\\$&"),"gi");this._trigger("filter",t,e.map(this.cache,function(e,t){return-1!==e.search(o)?(n.eq(t).show(),a.get(t)):null}))}else n.show();this.checkboxContainer.find(".multiselect-optgroup").each(function(){var t=e(this).nextUntil(".multiselect-optgroup").filter(function(){return"none"!==e.css(this,"display")}).length;e(this)[t?"show":"hide"]()})},_reset:function(){this.filter.val("").trigger("keyup")},updateCache:function(){this.rows=this.checkboxContainer.find("li:not(.multiselect-optgroup)"),this.cache=this.element.children().map(function(){var t=e(this);return"optgroup"===this.tagName.toLowerCase()&&(t=t.children()),t.map(function(){var e=t.data("subText");return this.innerHTML.toLowerCase()+(e?" "+e.toLowerCase():"")}).get()}).get()},_setButtonWidth:function(){this.button.outerWidth(this.options.width)},_traverse:function(t,i){e(i).trigger("mouseleave");var s=38===t||37===t,n=e(i).parent()[s?"prevAll":"nextAll"]("li:not(:hidden, .disabled)").first();n.hasClass("multiselect-optgroup")?n.trigger("mouseenter"):n.length?n.find("label").trigger("mouseenter"):(this.checkboxContainer.find("label")[s?"last":"first"]().trigger("mouseenter"),s?this.checkboxContainer.scrollTop(this.checkboxContainer[0].scrollHeight):this.checkboxContainer.scrollTop(0))},_toggleState:function(e,t){return function(){this.disabled||(this[e]=t),t?this.setAttribute("aria-selected",!0):this.removeAttribute("aria-selected")}},_toggleChecked:function(t,i){var s=this,n=i&&i.length?i:this.inputs;this.options.filter&&(n=n.not(":hidden")),this.options.multiple||this.inputs.each(this._toggleState("checked",!1)),n.each(this._toggleState("checked",t)),this.update();var a=n.map(function(){return this.value}).get();this.element.find("option").each(function(){s.options.multiple||s._toggleState("selected",!1).call(this),!this.disabled&&e.inArray(this.value,a)>-1&&s._toggleState("selected",t).call(this)}),n.length&&this.element.trigger("change")},_toggleDisabled:function(t){this.button.attr({disabled:t,"aria-disabled":t})[t?"addClass":"removeClass"]("multiselect-state-disabled");var i=this.checkboxContainer.find("input"),s="multiselect-disabled";i=t?i.filter(":enabled").data(s,!0):i.filter(function(){return e.data(this,s)===!0}).removeData(s),i.attr({disabled:t,"arial-disabled":t}).parent()[t?"addClass":"removeClass"]("multiselect-state-disabled"),this.element.attr({disabled:t,"aria-disabled":t})},open:function(){this._trigger("beforeopen")===!1||this.button.hasClass("multiselect-state-disabled")||this._isOpen||(this.checkboxContainer.css("max-height",this.options.maxHeight),this.position(),this.menu.fadeIn(this.speed),this.options.filter&&this.filter.focus(),this.checkboxContainer.scrollTop(0),this.button.addClass("multiselect-state-active"),this._isOpen=!0,this._trigger("open"))},close:function(){this._trigger("beforeclose")!==!1&&(this.menu.hide(),this.button.removeClass("multiselect-state-active").trigger("blur").trigger("mouseleave"),this._isOpen=!1,this._trigger("close"))},enable:function(){this._toggleDisabled(!1)},disable:function(){this._toggleDisabled(!0)},checkAll:function(){this._toggleChecked(!0),this._trigger("checkAll")},uncheckAll:function(){this._toggleChecked(!1),this._trigger("uncheckAll")},getChecked:function(){return this.checkboxContainer.find("input").filter(":checked")},destroy:function(){return e.Widget.prototype.destroy.call(this),e(document).off(this._namespaceID),this._reset(),this.button.remove(),this.menu.remove(),this.element.show(),this},isOpen:function(){return this._isOpen},widget:function(){return this.menu},getButton:function(){return this.button},position:function(){e.ui.position&&!e.isEmptyObject(this.options.position)&&(this.options.position.of=this.options.position.of||this.button,this.menu.show().position(this.options.position).hide())},_setOption:function(t,i){switch(t){case"header":this.header[i?"show":"hide"]();break;case"filter":this.filterWrapper[i?"show":"hide"]();break;case"checkAllText":this.header.find("a.multiselect-all").contents().last().replaceWith(i);break;case"uncheckAllText":this.header.find("a.multiselect-none").contents().last().replaceWith(i);break;case"maxHeight":this.checkboxContainer.css("max-height",parseInt(i,10));break;case"width":this.options[t]=i,this._setButtonWidth();break;case"selectedText":case"selectedList":case"noneSelectedText":case"noneSelectedSingleText":this.options[t]=i,this.update();break;case"classes":this.menu.add(this.button).removeClass(this.options.classes).addClass(i);break;case"multiple":this.menu.toggleClass("multiselect-single",!i),this.options.multiple=i,this.element[0].multiple=i,this.refresh();break;case"position":this.position()}e.Widget.prototype._setOption.apply(this,arguments)}})}(jQuery);
