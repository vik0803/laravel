!function(e){var t=0,a=/[\-\[\]{}()*+?.,\\\^$|#\s]/g;e.widget("multiselect.multiselect",{options:{header:!0,maxHeight:192,width:"100%",classes:"",checkAllText:"Check all",uncheckAllText:"Uncheck all",noneSelectedText:"Select options",noneSelectedSingleText:"Select option",selectedText:"# selected",selectedList:3,speed:null,autoOpen:!1,multiple:!0,showSubText:!1,searchDelay:100,filter:!0,filterMinOptions:10,filterLabel:"",filterPlaceholder:"Enter keywords",autoReset:!0,position:{}},_create:function(){var a=this.element.hide(),n=this.options;this.speed=n.speed||e.fx.speeds._default,this._isOpen=!1,this._namespaceID=this.eventNamespace||"multiselect"+t,this.wrapper=e("<div />").addClass("multiselectWrapper"),a.wrap(this.wrapper),this.button=e('<button type="button"><span class="caret"></span></button>').addClass("btn btn-block btn-default").addClass(n.classes).attr({title:a.attr("title"),"aria-haspopup":!0,tabIndex:a.attr("tabIndex")}).insertAfter(a),this.buttonlabel=e("<div />").html(n.multiple?n.noneSelectedText:n.noneSelectedSingleText).appendTo(this.button),this.menu=e("<section />").addClass("dropdown-menu").addClass(n.classes).insertAfter(this.button),n.multiple||this.menu.addClass("multiselect-single"),this.header=e("<header />").appendTo(this.menu),this.filterWrapper=e('<div class="multiselect-filter">'+n.filterLabel+"</div>").appendTo(this.header),this.filter=e('<input class="form-control" placeholder="'+n.filterPlaceholder+'" type="search" />').appendTo(this.filterWrapper),this.headerLinkContainer=e("<ul />").html(function(){return n.header===!0?'<li><a class="multiselect-all" href="#"><span class="glyphicon glyphicon-ok"></span>'+n.checkAllText+'</a></li><li><a class="multiselect-none" href="#"><span class="glyphicon glyphicon-remove"></span>'+n.uncheckAllText+"</a></li>":"string"==typeof n.header?"<li>"+n.header+"</li>":""}).append('<li class="multiselect-close"><a href="#" class="multiselect-close"><span class="glyphicon glyphicon-remove-circle"></span></a></li>').appendTo(this.header),this.checkboxContainer=e('<ul tabindex="-1" />').appendTo(this.menu),this._bindEvents(),this.refresh(!0),this.updateCache(),t++},_init:function(){this.options.header===!1&&this.header.hide(),this.options.filter===!1&&this.filterWrapper.hide(),this.options.multiple||this.headerLinkContainer.find(".multiselect-all, .multiselect-none").hide(),this.options.autoOpen&&this.open(),this.element.is(":disabled")&&this.disable()},refresh:function(a){var n=this.options,i=[],o="",r=this.element.attr("id")||t++,s=this;this.element.find("option").each(function(t){var a,l="multiselect-"+(this.id||r+"-option-"+t),c=[],d=this.className+" "+(n.multiple?"checkbox":"radio"),u=e(this).data("subText");"OPTGROUP"===this.parentNode.tagName&&(a=this.parentNode.getAttribute("label"),-1===e.inArray(a,i)&&(o+='<li class="multiselect-optgroup '+this.parentNode.className+(this.parentNode.disabled?" disabled multiselect-state-disabled":"")+'"><a href="#">'+a+"</a></li>",i.push(a),this.parentNode.disabled&&e(this.parentNode).children().each(s._toggleState("disabled",!0)))),this.disabled&&(c.push("multiselect-state-disabled"),d+=" disabled"),this.selected&&!n.multiple&&c.push("selected"),o+='<li class="'+d+'">',o+='<label for="'+l+'" title="'+this.title+'" class="'+c.join(" ")+'">',o+='<input id="'+l+'" name="multiselect_'+r+'" type="'+(n.multiple?"checkbox":"radio")+'" value="'+this.value+'" title="'+this.title+'"',this.selected&&(o+=" checked",o+=' aria-selected="true"'),this.disabled&&(o+=" disabled",o+=' aria-disabled="true"'),o+=" />"+this.innerHTML+(u?'<span class="sub-text">/ '+u+"</span>":"")+"</label></li>"}),this.checkboxContainer.html(o),this.optgroups=this.checkboxContainer.find("li.multiselect-optgroup"),this.labels=this.checkboxContainer.find("label"),this.inputs=this.labels.children("input"),n.filterMinOptions&&this.inputs.length>=n.filterMinOptions?this._setOption("filter",!0):this._setOption("filter",!1),this._setButtonWidth(),this.button[0].defaultValue=this.update(),a||this._trigger("refresh")},update:function(){var t,a=this,n=a.inputs.filter(":checked"),i=n.length;return t=0===i?a.options.multiple?a.options.noneSelectedText:a.options.noneSelectedSingleText:e.isFunction(a.options.selectedText)?a.options.selectedText.call(a,i,a.inputs.length,n.get()):/\d/.test(a.options.selectedList)&&a.options.selectedList>0&&i<=a.options.selectedList?n.map(function(){var t=e(this).next(),n=t.length?t[0].outerHTML:null;return e(this)[0].nextSibling.nodeValue+(a.options.showSubText&&n?n:"")}).get().join(", "):a.options.selectedText.replace("#",i).replace("#",a.inputs.length),a._setButtonValue(t),t},_setButtonValue:function(e){this.button.find("div").html(e)},_bindEvents:function(){var t=this;t.button.on("click",function(){return t[t._isOpen?"close":"open"](),!1}).on("keydown",function(e){switch(e.which){case 27:case 38:case 37:t.close();break;case 39:case 40:t.open()}}),t.menu.on("keydown",function(e){switch(e.which){case 27:e.preventDefault(),t.close()}}),t.filter.on("keydown",function(e){switch(e.which){case 13:e.preventDefault()}}).on("focus",function(){t.labels.removeClass("selected"),t.optgroups.removeClass("selected")}).on("keyup search input paste cut",e.debounce(t.options.searchDelay,function(){t._handler()})),e(document).on("multiselectrefresh",function(){t.updateCache(),t._handler()}).on("multiselectclose",function(){t._reset()}).on("mousedown."+t._namespaceID,function(a){var n=a.target;!t._isOpen||n===t.button[0]||n===t.menu[0]||e.contains(t.menu[0],n)||e.contains(t.button[0],n)||t.close()}),t.header.on("click","a",function(a){e(this).hasClass("multiselect-close")?t.close():t[e(this).hasClass("multiselect-all")?"checkAll":"uncheckAll"](),a.preventDefault()}).on("focus","a",function(){t.labels.removeClass("selected"),t.optgroups.removeClass("selected")}),t.checkboxContainer.on("click",".multiselect-optgroup a",function(a){a.preventDefault();var n=e(this).parent().nextUntil("li.multiselect-optgroup").find("input:visible:not(:disabled)");if(n.length){var i=n.get(),o=e(this).parent().text();if(t._trigger("beforeoptgrouptoggle",a,{inputs:i,label:o})===!1)return;t._toggleChecked(n.filter(":checked").length!==n.length,n),t._trigger("optgrouptoggle",a,{inputs:i,label:o,checked:i[0].checked})}}).on("mouseenter","label",function(){e(this).hasClass("multiselect-state-disabled")||e(this).addClass("selected").find("input").focus()}).on("mouseleave","label",function(){e(this).hasClass("multiselect-state-disabled")||t.labels.removeClass("selected")}).on("mouseenter",".multiselect-optgroup",function(){e(this).hasClass("multiselect-state-disabled")||e(this).addClass("selected").find("a").focus()}).on("mouseleave",".multiselect-optgroup",function(){e(this).hasClass("multiselect-state-disabled")||t.optgroups.removeClass("selected")}).on("keydown","label, .multiselect-optgroup a",function(a){switch(9!=a.which&&a.preventDefault(),a.which){case 9:e(this).parent()[a.shiftKey?"prevAll":"nextAll"]("li:not(:hidden, .disabled)").first().length&&(a.preventDefault(),a.shiftKey?t._traverse(38,this):t._traverse(40,this));break;case 38:case 40:case 37:case 39:t._traverse(a.which,this);break;case 13:var n=e(this).find("input");n.length?n[0].click():this.click()}}).on("click",'input[type="checkbox"], input[type="radio"]',function(a){var n=this.value,i=this.checked;return this.disabled||t._trigger("click",a,{value:n,text:this.title,checked:i})===!1?void a.preventDefault():(t._toggleChecked(i,e(this)),void(t.options.multiple||(t.labels.removeClass("multiselect-state-selected"),e(this).closest("label").toggleClass("multiselect-state-selected",i),t.close())))}).on("focus","input, .multiselect-optgroup a",function(){var a=e(this).parent();a.hasClass("selected")||(t.checkboxContainer.scrollTop(0),a.trigger("mouseenter"))})},_handler:function(t){var n=e.trim(this.filter[0].value.toLowerCase()),i=this.rows,o=this.inputs;if(n){i.hide();var r=new RegExp(n.replace(a,"\\$&"),"gi");this._trigger("filter",t,e.map(this.cache,function(e,t){return-1!==e.search(r)?(i.eq(t).show(),o.get(t)):null}))}else i.show();this.checkboxContainer.find(".multiselect-optgroup").each(function(){var t=e(this).nextUntil(".multiselect-optgroup").filter(function(){return"none"!==e.css(this,"display")}).length;e(this)[t?"show":"hide"]()})},_reset:function(){this.filter.val("").trigger("keyup")},updateCache:function(){this.rows=this.checkboxContainer.find("li:not(.multiselect-optgroup)"),this.cache=this.element.children().map(function(){var t=e(this);return"optgroup"===this.tagName.toLowerCase()&&(t=t.children()),t.map(function(){var e=t.data("subText");return this.innerHTML.toLowerCase()+(e?" "+e.toLowerCase():"")}).get()}).get()},_setButtonWidth:function(){this.button.outerWidth(this.options.width)},_traverse:function(t,a){e(a).trigger("mouseleave");var n=38===t||37===t,i=e(a).parent()[n?"prevAll":"nextAll"]("li:not(:hidden, .disabled)").first();i.hasClass("multiselect-optgroup")?i.trigger("mouseenter"):i.length?i.find("label").trigger("mouseenter"):(this.checkboxContainer.find("label")[n?"last":"first"]().trigger("mouseenter"),n?this.checkboxContainer.scrollTop(this.checkboxContainer[0].scrollHeight):this.checkboxContainer.scrollTop(0))},_toggleState:function(e,t){return function(){this.disabled||(this[e]=t),t?this.setAttribute("aria-selected",!0):this.removeAttribute("aria-selected")}},_toggleChecked:function(t,a){var n=this,i=a&&a.length?a:this.inputs;this.options.filter&&(i=i.not(":hidden")),this.options.multiple||this.inputs.each(this._toggleState("checked",!1)),i.each(this._toggleState("checked",t)),this.update();var o=i.map(function(){return this.value}).get();this.element.find("option").each(function(){n.options.multiple||n._toggleState("selected",!1).call(this),!this.disabled&&e.inArray(this.value,o)>-1&&n._toggleState("selected",t).call(this)}),i.length&&this.element.trigger("change")},_toggleDisabled:function(t){this.button.attr({disabled:t,"aria-disabled":t})[t?"addClass":"removeClass"]("multiselect-state-disabled");var a=this.checkboxContainer.find("input"),n="multiselect-disabled";a=t?a.filter(":enabled").data(n,!0):a.filter(function(){return e.data(this,n)===!0}).removeData(n),a.attr({disabled:t,"arial-disabled":t}).parent()[t?"addClass":"removeClass"]("multiselect-state-disabled"),this.element.attr({disabled:t,"aria-disabled":t})},open:function(){this._trigger("beforeopen")===!1||this.button.hasClass("multiselect-state-disabled")||this._isOpen||(this.checkboxContainer.css("max-height",this.options.maxHeight),this.position(),this.menu.fadeIn(this.speed),this.options.filter&&this.filter.focus(),this.checkboxContainer.scrollTop(0),this.button.addClass("multiselect-state-active"),this._isOpen=!0,this._trigger("open"))},close:function(){this._trigger("beforeclose")!==!1&&(this.menu.hide(),this.button.removeClass("multiselect-state-active").trigger("blur").trigger("mouseleave"),this._isOpen=!1,this._trigger("close"))},enable:function(){this._toggleDisabled(!1)},disable:function(){this._toggleDisabled(!0)},checkAll:function(){this._toggleChecked(!0),this._trigger("checkAll")},uncheckAll:function(){this._toggleChecked(!1),this._trigger("uncheckAll")},getChecked:function(){return this.checkboxContainer.find("input").filter(":checked")},destroy:function(){return e.Widget.prototype.destroy.call(this),e(document).off(this._namespaceID),this._reset(),this.button.remove(),this.menu.remove(),this.element.show(),this},isOpen:function(){return this._isOpen},widget:function(){return this.menu},getButton:function(){return this.button},position:function(){e.ui.position&&!e.isEmptyObject(this.options.position)&&(this.options.position.of=this.options.position.of||this.button,this.menu.show().position(this.options.position).hide())},_setOption:function(t,a){switch(t){case"header":this.header[a?"show":"hide"]();break;case"filter":this.filterWrapper[a?"show":"hide"]();break;case"checkAllText":this.header.find("a.multiselect-all").contents().last().replaceWith(a);break;case"uncheckAllText":this.header.find("a.multiselect-none").contents().last().replaceWith(a);break;case"maxHeight":this.checkboxContainer.css("max-height",parseInt(a,10));break;case"width":this.options[t]=a,this._setButtonWidth();break;case"selectedText":case"selectedList":case"noneSelectedText":case"noneSelectedSingleText":this.options[t]=a,this.update();break;case"classes":this.menu.add(this.button).removeClass(this.options.classes).addClass(a);break;case"multiple":this.menu.toggleClass("multiselect-single",!a),this.options.multiple=a,this.element[0].multiple=a,this.refresh();break;case"position":this.position()}e.Widget.prototype._setOption.apply(this,arguments)}})}(jQuery);
